var bh=d3.blackHole("#canvas");var hashParent={};var stepDate=86400000;bh.on("getParent",function(b){var a=hashParent[b.parentkey]||(hashParent[b.parentkey]={img:b.img,key:b.parentkey});return a});bh.on("getParentImage",function(a){return a.img});bh.on("getParentLabel",function(a){return a.nodeValue.key});bh.on("getChildKey",function(a){return a.childkey});bh.on("calcRightBound",function(a){return +a+stepDate});bh.on("particleAtTarget",function(c,a){if(c&&c.nodeValue&&c.nodeValue.attackto){var d=c.nodeValue.parentkey;var b=c.nodeValue.attackto;if(d!=b){var e=c.nodeValue;e.parentkey=b;date+=2;e.date=date;bh.append([e])}}});var inited=false;bh.setting.drawTrack=false;bh.setting.realtime=true;bh.setting.asyncParsing=true;var imgs=[];for(var ii=0;ii<10;ii++){var image=new Image();image.src="avatar/"+ii+".png";imgs.push(image)}var data=[];var testd=0;for(var ii=0;ii<10;ii++){testd++;data.push({childkey:"begin",category:""+flag,parentkey:""+ii,date:testd,img:imgs[ii]})}var cleaninitchild;var Myhole={start:function(c,a){var b=[];$.each(c,function(e,d){var f=new Image();f.src=d.avatar;b.push({childkey:"begin",category:""+flag,parentkey:d.team,date:0,img:f})});bh.start(b,0,0,false,a);cleaninitchild=setInterval(function(){if(bh.children().get("begin").alive<=0){bh.setting.drawTrack=true;clearInterval(cleaninitchild)}else{bh.children().get("begin").size=0;bh.children().get("begin").alive=0}},1000)},isStart:function(){return bh.IsRun()},attack:function(c,b,a){flag+=1;date+=2;bh.append([{childkey:"_"+flag,category:c,date:date,parentkey:c,attackto:b}])}};var flag=0;var date=1000;var attackflag=0;function test(){setInterval(function(){date+=2;flag+=1;var d=myrandom(null);var c=myrandom(d);if(flag%2==0){d=1;c=2}else{d=3;c=4}bh.append([{childkey:"_"+flag,category:""+d,date:date,parentkey:d,attackto:c}]);attackflag++},10)}function myrandom(b){var a=Math.floor(Math.random()*10);if(b!=null&&b==a){return myrandom(b)}else{return a}};